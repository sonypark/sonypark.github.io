2019년 8월 9일

# Relationships and JOIN

---

> key words: `JOIN`, `FOREIGN KEY`, `PRIMARY KEY`

> **images source** on this post is from [The Ultimate MySQL Bootcamp: Go from SQL Beginner to Expert](https://www.udemy.com/the-ultimate-mysql-bootcamp-go-from-sql-beginner-to-expert/)

## Relationhips

1. ONE TO ONE RELATIONSHIP

    - ex) Customer ←→ Customer Details
    - 실제 서비스에서 거의 없음.
    - 2,3 번이 가장 많다.

**2. ONE TO MANY RELATIONSHIP**

- ex) Books ←→ Reviews
- 하나의 책은 여러 리뷰를 가질 수 있다.
- 하나의 리뷰는 하나의 책만 가질 수 있다.
    - 하나의 리뷰에는 특정 하나의 책에 대한 리뷰가 담긴다.

**3. MANY TO MANY RELATIONSHIP**

- ex) Books ←→ Authors
- 하나의 책에는 여러명의 작가가 있을 수 있다.
    - 여러명이 하나의 책을 쓸 수 있으므로
- 한 명의 작가는 여러권의 책을 쓸 수 있다.

## One to Many

- 실제로 가장 흔한 관계가 일대다(One to Many) 관계(relationship)이다.

- ex) Customer ←→ Orders

    - 고객 한 명은 여러 개의 주문을 할 수 있다.
    - 주문서 하나는 특정 고객에게 고정되어 있다.
        - 12번 테이블의 주문 내역이 찍힌 주문서는 12번 테이블로만 가야한다.

- 유저가 주문한 내역을 관리하기 위해 **하나의 테이블**을 사용한다고 가정해보자

![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/3717e07b-f0f8-43e8-beb7-beb6f9d10d8c/Screen_Shot_2019-08-06_at_4.06.40_PM.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45EHYGMBVF%2F20190810%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20190810T050648Z&X-Amz-Expires=86400&X-Amz-Security-Token=AgoJb3JpZ2luX2VjEBIaCXVzLXdlc3QtMiJGMEQCIGiapBco7Q9qHzzO11DfUGKkVqTuHOHFVTat86%2Bprn%2BDAiAi31N6RfeJXjlJF7sGioLK7dzgz3BWY5MDyVBLM%2FGHCirjAwib%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDI3NDU2NzE0OTM3MCIMreCIm7WPQdy29Kl4KrcDaeiTpKlAtiFLRpRAHYdCGEanzgmiHK%2BgkZ5%2FEB2yVf5%2FTO8o%2FhZlwaSELxSviM5THpwc7SkaVCWdK6juG1NAVbB0y54EmV%2FSf%2BmwMw2JhrenGk8ip9irIgCG6CFbbSl8qu2kzxJcyUV4j82rgKzaH3fJuwz6nrqD0WYecSGMnOxTFCWtszW131DIS1RddYwrakYvJ%2Bq2NKeuoLrPqNmivv9YT0n3woCnSKQEeqtFWiUMCjhucFuqahlESAKKahvheFEijwPcXMbpHwWRQBndIVAk4QVoFOY4VL%2BzhS9nHLzBw1mIgaTCnf%2Fw%2BkWpkw76errtkqog%2FHKAIMOAeVplE1BNSuwiscs6ATtzAXmvj6aZcksnF4tsqzxJPoSMdIEQqnK%2FZKFbos76WVi58lfZjc8qJWsor8qmaU9ad9%2FQGUNHnZ7657krqMLxkBf3GIHnu69Eo34%2FjzoYRNThKdJONtgYzQ9k9ahRCA9iw7FAPsyn%2BO%2BfhjFLrJ3SC4dotzra3cZrS3hYH9OCzQF%2FTdor2%2BJbWwnp4MCTN8gbzA%2FNjtAniRk2fpnt%2F6yAYIyN5su8DH5btA2jAzCYy7jqBTq1AaJrM9eLumX9RUs7N3g%2BND455QSq3c5ICdZHazIhnif3s0MAz%2FJ3bmJF%2FusL%2BKc7j%2BUTwES0rids%2Ft2OMWj9WlQkaIyQOS9DVWKXQJ6tygJSwO8q4nsQWQZZBN8%2Blmibfd2U36jU137hq21H7NVeam%2FPkRCdHMSyPpRUQUL3mGgVG%2BsU1oSrBI7W%2BvC6703ARTwdG5LGuu4gUkmXeKEsLOuMGQZyLJnpsTl9skYIpKZHsLceHcs%3D&X-Amz-Signature=4954203744d19e9fd807b2806cebe24b354f978daafdccbd0b53b84be34123cb&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Screen_Shot_2019-08-06_at_4.06.40_PM.png%22)

- 위 표 처럼 만들수 있다.

- 그런데 위 표는 문제가 있다.
    
    1. **불필요한 `중복`** 이 있다.
        - 같은 유저의 이름과 이메일이 중복으로 저장된다.
    
    2. **불필요한 `NULL`** 값이 담긴다.
        - 주문 내역이 없는 유저의 주문 관련 셀에 NULL 값이 들어간다.

- **테이블**을 **두 개**로 나누면 위 문제는 해결 된다.

![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/28de56de-7795-4a98-969e-d72fb29058d2/Screen_Shot_2019-08-06_at_4.03.27_PM.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45BQNO55XV%2F20190810%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20190810T050714Z&X-Amz-Expires=86400&X-Amz-Security-Token=AgoJb3JpZ2luX2VjEBMaCXVzLXdlc3QtMiJHMEUCIDYOmWGW%2B6AufgUiCXwMfv5Yt277c%2BUSfgIIfHusrnJdAiEA52uRW1yICz81%2BT1yC%2BgxWPOnB3jDoCNRUweKM2moT%2BMq4wMInP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgwyNzQ1NjcxNDkzNzAiDHxBJo8GF3XOrDj4MSq3A%2B2IMvumR5df43sJarbC791%2FwFs1XwVEji9rDv8SlOp3HfmzepVcWB2yg7hPKRXRoXxbQgG9vOEjMXIotclUkC2Mjv7oBAu8WjsPYQ8wFPulBpgvyZPgfH1jrlvMk10d6PzqbejhJvw0spWTflvxhABEe4Ur2A7hpwa5K2J5CD9%2BQXs5zP4wM0EDfo0YDON%2B5ltyXZV%2BOndW4KupJf%2BeFmVBt3ROzfHCyVyUjJmhTfJf3iuEa55MQ99RYdtCFy0sr6j1APliFqz2%2FWtey5p6ahObuOWzPYfNffKHhBIGecYqEb5%2BW03s6JBURlG8cYmoII4aTCAeQaT%2BicKG37iWn2EvQrDAwMt6AR5R7kQ2cMoudcGkFbFHG4LnMdV9ep2vR1g08NWjLvhGqTYPY5obyZNMpFAoBw5Qm%2BqAhm6rTGYXDdHlnR6zs%2B1H66ZsOzgym%2FGkCA49zl75KsSv1z5ZWDZ%2B4RDVUJPQpdTvqQhDzjW3O%2B%2BP0nZ3qCsYtErHRVtQLGb3OF0KbQUGrpsaV0qpdipDOY5abYqR3F9NNVqyKvy0J5ppu8DA8Qd5m2JbMT5bMiBhmdwXYMQwlti46gU6tAGGVUElyuS%2Be6L3JT2lS4l%2F6alSItqIaI5n9beiJUsnYzmL%2BR7LpIV0Qci%2FWS8CblVrhHxEZJ%2BZ2Ss0einB8obIeKbOfMoeIyWGj4TpQjmvosBy5CCPfmDX4SuvzeuEQ9c20DXzLPCD4k9U4xJngPU2%2Foyfbb708ZA6z%2FeetoM5grvnzjqhjvQP6TNa6jiNWoFyqA%2FnjuHafWwRqAvSI5uuixRPaRPVv42Kg%2BF1zug6iG4uXIk%3D&X-Amz-Signature=87410c5c1c0653085bb857f8184ba45c6b0bc81608b75e426111cfd0f06318f8&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Screen_Shot_2019-08-06_at_4.03.27_PM.png%22)

- 위 그림처럼 Customers, Orders 두 개의 테이블을 만들고

- Orders 테이블에서 Customers 테이블의 customer_id값을 참조하게 하면 된다.

![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/7a1f2254-5e9f-48e6-b2fb-116617ab2bea/Screen_Shot_2019-08-06_at_4.03.21_PM.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45PIRYDLJX%2F20190810%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20190810T050731Z&X-Amz-Expires=86400&X-Amz-Security-Token=AgoJb3JpZ2luX2VjEBMaCXVzLXdlc3QtMiJIMEYCIQDe0DxfpG5jNIlEZPurY3zU9QGqkMTH8OsGIEuMBq5WewIhAJUS%2FDNlslFCwqRawQiVerwABu9woqBW7pzz2NvoH%2BchKuMDCJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMMjc0NTY3MTQ5MzcwIgw%2FaGf6Gh2AJvlqRUoqtwNiZ6VIxemy7CYA71phXTky%2FzJYqWnEdTJLDpWKMqmzvdt8WarpkHKAjgUc3j6goUv1Fj8gue7RvlyawhIVyEslL%2B4nK8XXoxF9z3uplngSApdLODeKTpYXlSxMdyaCZR0nEGqJUSZQgTvR50z05tJYBo%2BEUQI3yZahoMUnfMuKBDlb7ozHei4V2sX5y9XDJMnopMWz60Z2OsWFNHDppjA5jTDG%2BxctnyL79FfO1mOybG41GxxCbFdmvZBOtObGiaAfnpU93kK62RIt%2FDY5CwCpk2eiDrSSJ2eDxK0JuG50Ci6M1VOV%2FfzHaJydCme0LnP465XVNduZRAe7NfCGhu%2Bp8YqwLulrPeOfqlMAC%2B%2BRhjVuiAfCyOLNGptCL9FdNzPP7DM86igZGAylmbg%2BQgTAurp%2B8%2BZyALAyMZeHgiD3SJ0C4cISbluk1GmZriZDUod9MEhnKXFvMKCNXWOxADjFkCX9oHvkb5YON6eXW0ysHDTX0tzkamx0AHikh9Q0QIdK23%2BiPpaUn2pEixg4vK95yCvhxTKQVs8V7Pmd0RlYbIdqNlVB%2Bv%2FOBLQmJ5Y4c0kObNsic2NCMKjVuOoFOrMBizeMi9N%2F4YRrDnosJCUeHHK6LVONSoiIMPOimYLTkPmsfQuxSPEf4R6%2FsEtydekYzzjUW2HKAV0x0ltf1f4kqwAt29WsUx9SDIDFYQKnOfpH5NVTTnga%2BpURRFSZwvy6dwBBArLCagd5fCU9N41QLN%2F%2BoYeqvhCoTAt3qE1lgRSonBNfpKckBGKOTAKMTr12MRHIaWPsvaSTeIjNIglSdMwJMvvG82BN1pSzHca8nosmCQA%3D&X-Amz-Signature=50bf0269952639bddadf8e4b12b692f45e7e2cc714d5515ed2eaccaaa61cace1&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Screen_Shot_2019-08-06_at_4.03.21_PM.png%22)

- id 값을 참조하게 함으로써 불필요한 중복과 NULL 값을 제거하여 데이터를 더 효율적으로 관리할 수 있게 되었다.

- 각 테이블의 **id 값**은 **유일한 값** 이어야 한다. 
    — 중복된 id 값이 있으면 어떤 데이터를 참조할지 모르기 때문이다. 
    — 이러한 **고유한 id 값**이 해당 테이블의 **Primary key** 가 된다.

![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/40ede873-86ce-47e3-829b-6c1d5f8c9616/Screen_Shot_2019-08-06_at_4.13.12_PM.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45FBPQ5R4A%2F20190810%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20190810T050742Z&X-Amz-Expires=86400&X-Amz-Security-Token=AgoJb3JpZ2luX2VjEBIaCXVzLXdlc3QtMiJHMEUCIQDuYzYI3DjpXeikYuScrXR0JfopMgRUf55PmP5f5KLzVgIgLeB0HjduHPfRmyxhBmXEUaZAM9dNC8YTlLH1uUZ5Bh8q4wMIm%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgwyNzQ1NjcxNDkzNzAiDNzvZtNeIScxum3GFyq3A8AsOZJtuzeJwD5OAjLwj4Cb14QUYDtdCit9qKQkBK82xWVx0qYAbuPdlHiHeCHPZNmcnASWWYXok0IeGbTHhqumk30YnTzC18UhQAXbfZJ9%2Fpg8cdIrdwU%2BpWWKqrYp1EeR%2FWefzGEnpHh2tF11rXuGFfyoQn5JSpz5s4ilhFDF1T2Lsm5kIN%2FpXlR9FwWxOSdSQouu7GCD7p04AEuUb8r%2FAIirUCB0nsYmFxYye3ZNUwON9egYviIRYDy3lzPtNh1Ykr5J3rtbHGopYIT1aJCbc0M2rOOKxhjTIl%2F%2FOQl9Xi0lzu9xM5B7EwhSPK%2FM1LHRHDNomoNbCLkM4gqmfAiM1iZJ%2F3niTUwRp28Rh5UBrwxV8ewdmp4ZAo30ZddJu8t3w1CihVGFgrTXLkUIlcV4dHxnvR156g3aio1HeoLMmnotsaojxhQoI6KkJ7ZoITFHYBGfT8qJmMUSw%2BpoKhxELQIWX5lKFpefy8Eb4TngFJZ00LYei449iwHtvjoYfX0kK05FjkgE%2BlmYzs2X19l7XnLuciJoi0icskOHXWve21f6A6BBAe6yQI8MzRJOmgGGXPuvEYAw1cO46gU6tAFRf0%2Fj8B3Djp0IynO3rQSKbU1myJy2Yt9cMOrAFReoDJ4EPYOYns5tyDqKFn3Q6hqb6RiUs8gK%2BSnA72fANdsC80KNRxoUYUYt%2Bm81%2FbDhVhdjsjM5NydgolTfakBvCjbzmg4xLWvXH1sxW2ImABVRjbtTx8Vrtd6EHGaT3FyXB92bVbug5pFVySuZRBXMrXbAEIfNkVAGLWmmgmmJvaHg3GiLgBNg%2FKRSlDn9J8%2F0%2BRoalDE%3D&X-Amz-Signature=df72c878b3135ed18a483cb39df34fd7c2557d12c7b66ddb8a9d4ebe328329da&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Screen_Shot_2019-08-06_at_4.13.12_PM.png%22)

- 그렇다면 특정 테이블의 **Primary key**를 참조하려면 어떻게 해야할까?
- 이 때 필요한 게 바로 **Foreign Key** 이다.

![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/83235196-b22b-4758-8928-a6c353582a20/Screen_Shot_2019-08-06_at_4.16.24_PM.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45NMHTNB4G%2F20190810%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20190810T050800Z&X-Amz-Expires=86400&X-Amz-Security-Token=AgoJb3JpZ2luX2VjEBIaCXVzLXdlc3QtMiJGMEQCIEmm2gpAVDTo52EGhbW0jweI4%2B%2FqqjBV1kk%2BoL4GMCmEAiBNGU4P%2FznbUAc99VnapZ8oRZRVv%2B3FejzQow%2ByRMytqSrjAwib%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDI3NDU2NzE0OTM3MCIMT%2FAoyFdM9bUsPy1AKrcDg3MKfAqLGj6PDbo0EC8HLSNyl5B4Xsmil7Ty1FTX6nC9yZTQC5eIk2kJKLzBTlSc4%2FVznkyC52qi%2Bjmo9YCS%2FPlRZfziYkqm8EMOSnFVysir83vNmPUY8e1pdWAVgL8ncyqpFqvbXYJVyuDUYmKE1hWEtBKFdRhcyMZXyte4vEhLj6Acy5cXQ8cfwrZKuGuVS6PDvLZmCMBhcgQlEyWAkDdYIPH9oHmA%2BfTJxflL9wiSFYs4LmI2ObRe4gfqeAqJ9tEasefS4GL%2Fn9z03lnLAoEP%2FYj7phpNVeh4bvxts9LdjVSdjizOB%2B99KEN3eCbjJ8FttKD9seN6RRPoaf6BNL6gG%2FJspVSodosZoX3yGkdWOH5nP%2FPefUOQh6etJQwtmXeEuGgNmz%2BGKdbEy58bJO8H%2FkT6TIdGFSVg%2FMgWL5LKu5I91wnRqE4%2BPi4KThrlnhApU6zkgmxoQoQi4yJTgpeYJe%2BFISW6lD5eAvfcnoqfe7Xj9iDlWARNewj4bQTVQGGPcot8bJyKZdWfXuDoehfdQOWaiBkkd8HJDvTfhVQtEAdEogavlNvT60eih1KylqyzjMyzxDDGybjqBTq1Acqb8XplJbhfh3rBYyPMmeQcQfBGF7TQmPx8f%2Bz8Cn4WZEdEei5vvgl239J3Hoannb61qTay4qzAIWEOI6KYMsxPFE6X%2BrIW5GQe6sR0q%2BBlT91eWUaTLml3e%2F5lmpvcOdwdMHQm5u%2FRVhoUSOn%2BrhG0CNxXTfxFdel3kvFm%2F%2BrxJt0R1T9kHu4Q77XC51mMh3AxYdf7PxHNQ3OCJQQD85A9pQKGZwxdoFtk0pvHKqL2rz8uyEs%3D&X-Amz-Signature=47608f595cbbd36154b0d5fb550d7872191087d1d088a39500c549265ca5c2df&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D"Screen_Shot_2019-08-06_at_4.16.24_PM.png")

- Orders 테이블은 Customers 테이블의 `customer_id` 값을 참조해야 한다.
- 따라서 Orders 테이블의 **Foreign Key**는 `customer_id` 가 된다.

### 정리

- **Primary key:** 해당 테이블의 데이터에 부여되는 **고유값**이다. — 유일한 값이기 때문에 **중복되지 않는다**.

- **Foreign Key**: 다른 테이블을 참조할 때 필요하다. Foreign Key는 **참조하는 테이블의 primary key**여야 한다.

```
CREATE TABLE customers(
    id INT AUTO_INCREMENT PRIMARY KEY,
    first_name VARCHAR(100),
    last_name VARCHAR(100),
    email VARCHAR(100)
);
CREATE TABLE orders(
    id INT AUTO_INCREMENT PRIMARY KEY,
    order_date DATE,
    amount DECIMAL(8,2),
    customer_id INT,
    FOREIGN KEY(customer_id) REFERENCES customers(id)
);
```

## Many to Many

- Books ←→ Authors
    - 하나의 책은 여러명의 작가가 쓸 수 있다.
    - 한 명의 작가는 여러권의 책을 쓸 수 있다.

- Blog Post ←→ Tags
    - 하나의 게시물에는 여러개의 태그가 달릴 수 있다.
    - 하나의 태그는 여러개의 게시물에 달릴 수 있다.

- Students ←→ Classes
    - 한 명의 학생은 여러개의 수업을 들을 수 있다.
    - 하나의 수업은 여러명의 학생들이 들을 수 있다.

![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/68d9502a-8973-47c6-97ba-2fcf5a9b3824/Screen_Shot_2019-08-07_at_4.36.34_PM.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45D47YT5FG%2F20190810%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20190810T050923Z&X-Amz-Expires=86400&X-Amz-Security-Token=AgoJb3JpZ2luX2VjEBMaCXVzLXdlc3QtMiJHMEUCIQCbw1rqJY%2FoQ8eoJYw3fgw4tnkfuWbuT%2B188F03VuUmEgIgJRK9VsDT89rS3A3%2FK7qVMxS4ljmy1SUPN2tnMCmdowMq4wMInP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgwyNzQ1NjcxNDkzNzAiDArbr8oGqBOC6nQykCq3A6%2B%2Fw%2BsazrmGevukECP7URnAWNNqDGJsQF%2F2%2Bmt6EhnkLdhrjWMhCmii%2B7dJsm4iwejkEoyUAThjnGBBggB%2B3OPBBklsT6UEqpjpeqQzk3hEC7LoDKec2v4GHE3sjvNx049b%2FZN3Z0jW5JyX39czdP3mXs6UrAUybF3Cq7OyJlbgA%2BOj9ywlCTLLG9I9ZdfxOCL0QsvJQJe2GZy%2BXnE5M0rTlVZEonNzil8bdtKZyZSdBA7%2FtccQ7q4wB4vPXYgA4foSQAY4Fag16KRtLHKtiCYbOYUm3waa889tOp9uKyRdkqSR4RdqMm%2BmbtBRe7JIU8%2BgoxWVWUGa9rN608a%2FzMaPSBGXPBKDLhnm81qIjFTQFNSRgpvW4UBms2A%2F1WyzFzwFDBx7YJ%2FQRrlMgO2SGx2U%2FrGv0U5eeVPAvn%2BpAryvCpA6m07XmAfgbxYfyJ7tN9BkNSg3j3SYUkIHMbzHg4BAEWsdGgxfiJq%2B38oZZPm3tNI0wTPFp8la8lEypdlB6vRkpkHJENp5uBwbG80pB063%2BjkEfc7wGx%2FR%2FQjxV4YspN2LfoH43V58fFbfAZ0%2FGSr%2BueQ48EAwqte46gU6tAH0cUJzYv8SJR9K4SXgNYwTPJAQ9%2FDWPJ0Mj9reSMTqJZmODt9HIHNEBRuhTSqPxafF6qwwGekK1y4%2BcDuXsSEXSPHb9zVcwA5EtnUQ9PUj7M35M%2BLxpggOBH5LigSyjQ9Ro13Nvit2QTNbPsXdLBL0uhmjM1YSyGltpkIkrRSFcuPb8uzKoXJKEjIZdbRgx92vF05JJrvw4nlA8VhnrO2ly7jyPvchMytIKiMCamnRAeSHKDY%3D&X-Amz-Signature=7eb90e8efe6618141af213c50eb396dc1283b94e1015fc4e742c2940e287cd8a&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Screen_Shot_2019-08-07_at_4.36.34_PM.png%22)


## INNER JOIN

> `JOIN 명령어는 INNER JOIN 이 디폴트 값이다. (JOIN = INNER JOIN)`

![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/67418122-0d01-4805-8818-f677abc43168/Screen_Shot_2019-08-06_at_5.06.35_PM.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45F4UFMJ7A%2F20190810%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20190810T051013Z&X-Amz-Expires=86400&X-Amz-Security-Token=AgoJb3JpZ2luX2VjEBIaCXVzLXdlc3QtMiJHMEUCIEKdviRyyIpBMPDazrIwTELW2%2B60Tj1nTil8niZxB21vAiEA4%2BPeIKRqG8UWiiBj8qRALtzoqhc1PwZHOTSJz1Cqy80q4wMIm%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgwyNzQ1NjcxNDkzNzAiDAneInxJeahknPHmoyq3A7Z%2Fu4qfA9iv5ffiB5DEO0i6bf3bgLybAvl3dvxqO8FVjM6f3pVstqhTHZoZ7mXxlXiEN%2F%2BEsaTW4A%2F8uTNoVDO0VCPcP3aAEODqYnde2Ch1oRX3Vx9SPHFKGMEvvIVmGW9gS%2BitFz%2FaBeBT0QKjeS%2Bro%2FmDV0cEFP1KUoImbfVA6%2BsZUAlhub%2F3v%2BmrpLc%2FV8iMkCPBuT7jEnqasH3x%2Byha83kMVGm4hSMNHXdeMwjt9NKm6A%2F6UrCC1q4%2FGpO9iekxLLfqnU7sZowuLKtGSYFvUYl7796tWqyUyX0rJzyH7bJOFAUMngULpJoZ1vU5907rQsTeCVnUNd6ZGrhjAxY6wLfgqwvvzH%2B25mpi9d2ysZhNFEadksgN8BGpSPzIOy0ijSQembwgq8hcgFa3%2BBOXK2uSK64ESu5tkmOGJXnKj0DIioyTbbXUrvoVF%2BXBrF1gp%2BpvntGaD8FTaLXPpADb0RiHqrUQGndnFgVpdORPsz9jRbMNjQkHFOXf96fn7hHDUQqkzOm4Nt860BAJ7FXNYa8EHSeXeFlJv74L6nJUncjMghXG4xuat5fptdzoLFYUT%2ByBXG8wlMu46gU6tAEvz1HbDmEYo165DWz3BUnlMs40WTXWDJKV8NyJaazX1g9zD0ifYfA2Yp279svjLjoM%2BJrNUbTukcWk7X0yH0kVpgySiHiQHXxVRTne6425lMCC4B55lpicX2prnV2hqhUuh22XcJhICF0JnwYgyflUayg3oJYckNRsuGaQF18UZFu2U65pa%2FVTSKeg2Yx6EQOylDMSGyOEaxfvR8%2BQep6v%2FZDQ5r%2BPC7QwF6WRnKUMIRJuoqk%3D&X-Amz-Signature=dfaa97d91076973364b4da89b855ced039b7cd38cc58db7e8fc765f4b30145cc&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Screen_Shot_2019-08-06_at_5.06.35_PM.png%22)

- 위 그림과 같이 A,B 테이블의 **교집합**을 리턴한다.

- 예시 코드는 아래와 같다.

```
SELECT * FROM customers
JOIN orders
    ON customers.id = orders.customer_id;
    
SELECT first_name, last_name, order_date, amount 
FROM customers
JOIN orders
    ON customers.id = orders.customer_id;
    
SELECT *
FROM orders
JOIN customers
    ON customers.id = orders.customer_id;
```

## LEFT JOIN

> `RIGHT JOIN`은 `LEFT JOIN`과 반대로 동작한다. 원리는 같다.

![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/a16c05ff-106b-4c92-879e-c36f274ea88d/Screen_Shot_2019-08-06_at_5.22.23_PM.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45OUD2RPLK%2F20190810%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20190810T051029Z&X-Amz-Expires=86400&X-Amz-Security-Token=AgoJb3JpZ2luX2VjEBMaCXVzLXdlc3QtMiJIMEYCIQD6MGBUE%2B1l1HmUOHRMYd9f4axaVB2vIy5YZhxZ%2Fx0t9wIhALW%2BNZtJr6ZaQYjTjtXIaThnmB1LJZC4bgu66b4lTXwYKuMDCJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMMjc0NTY3MTQ5MzcwIgxNC0aI5X6isB%2FtR6QqtwPP%2BvuqXaTE1gIEELBg0fbv0VaucCqGc3lvcBX5CFsaeHjLq%2BOOJl3PH4%2Bh32ywiW3fgd2Zi%2Fkv6i%2B6TEKuu4pXO8gJRKU1xJaDjDh2sdzs7Pt4pfxn2EV8Uu%2BIXhmGGCh%2FCW0s0JpODmyXBmbM6IUcUuIQ4G%2BXr8EY5IzVs59Aq5p92ca%2BHGnW3TcUH2ivVZzdy9PX5w6%2BTWMGkXfBwCoHRNz3KsoAAEC4tgWW%2BjV87AjjuGjixVj9s1GpLQReX%2FYzeaN%2FApB%2BePaxccRYa3ckZUPN2cboVaYuXa8%2BJpcELi6HqzsF29hHSqsP9AOzJpWBkarSQ%2BLAyS8oihDw6gZg1idAzFZ8AFYu7VwmauKC%2FYCLFpPXAlcca7MOyjwiFput0auKp9N65eMNPmRoZvp1Q%2BYfQM%2BBCuxtqf2WGmLy%2BWjambd56oXpKhqGigUDNbOdPtFgCD04KfEnfDxr5Sl1BDuDi1VlQKTsRSAH6UFm7jlIxxU8NScuIfFaOUuTuDgjsRu%2Fh%2FqootCxqJX3fvHNJZ8Y519RSttBLXravwy4M1sf2agJOOCSYEkk0P2PcGthI%2BBTW3vzMIrYuOoFOrMBA5184gPWCGgNu2zeKboh2xDBCV61M3awxRMYrQKe6rJM9T7%2F6Khnm34%2BOnfW4zc4ifb5hr8Zhtwd7Ny0DWp%2Bio4h7gwiYAOw%2FD6DetRnBl7JQ8h3pJso0e9dlF4M60SAnnQUKFTE71zwJ3AK%2Fwh5FzRDBQzc0GbNt7CAvFbVUv2SfWv7CwKy7N1c7lkM5znO2vZvDvn%2B8Rvaf4xXfWd8HtqmGOHQPUHPMHTBvM69qEICFjY%3D&X-Amz-Signature=b37da45dd3e096c93efefb810d579273e4bcc2c078e25e21562eb175f3db6bc2&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Screen_Shot_2019-08-06_at_5.22.23_PM.png%22)

- 위 그림과 같이 A,B 테이블의 교집합 이외에 왼쪽 테이블(A)의 데이터를 모두 가져온다.

- 코드를 통해 `INNER JOIN`과 `LEFT JOIN`의 차이를 살펴보자.

#### INNER JOIN

```
SELECT 
    first_name, 
    last_name, 
    SUM(amount) AS total_spent
FROM customers
JOIN orders
    ON customers.id = orders.customer_id
GROUP BY orders.customer_id
ORDER BY total_spent DESC;
```

```
+------------+-----------+-------------+
| first_name | last_name | total_spent |
+------------+-----------+-------------+
| George     | Michael   |      813.17 |
| Bette      | Davis     |      450.25 |
| Boy        | George    |      135.49 |
+------------+-----------+-------------+
```

#### LEFT JOIN

```
SELECT 
    first_name, 
    last_name,
    IFNULL(SUM(amount), 0) AS total_spent
FROM customers
LEFT JOIN orders
    ON customers.id = orders.customer_id
GROUP BY customers.id
ORDER BY total_spent DESC;
```

```
+------------+-----------+-------------+
| first_name | last_name | total_spent |
+------------+-----------+-------------+
| George     | Michael   |      813.17 |
| Bette      | Davis     |      450.25 |
| Boy        | George    |      135.49 |
| Blue       | Steele    |        0.00 |
| David      | Bowie     |        0.00 |
+------------+-----------+-------------+
```

- `LEFT JOIN`은 왼쪽 테이블에 있는 모든 데이터를 다 가져온다.
- 위의 결과를 보면 customers 테이블에 있는 모든 데이터를 가져왔다.
    - 즉, orders 테이블에 customer_id 값이 없는 사용자까지 가져온다.

### LEFT JOIN은 언제 사용할까?

- 위의 예시를 보자
    
    - `INNER JOIN`을 하면 주문을 하지 않은 사용자의 데이터는 가져오지 않는다.
        - 따라서 구매한 적이 있는 사용자만 보고 싶을 때는 `INNER JOIN`을 사용하면 된다.
    
    - 반면 `LEFT JOIN`은 주문하지 않은 사용자의 데이터도 가져온다.
        - 따라서 고객들에게 판촉 메일을 보낼 때
            - 구매를 많이 한 사용자에게는 감사 인사와 함께 선물 증정 메일을 보낼 수 있고
            - 구매 내역이 없는 사용자에게는 할인 쿠폰과 함께 구매 유도 메일을 보낼 수 있다.

```
CREATE TABLE customers(
    id INT AUTO_INCREMENT PRIMARY KEY,
    first_name VARCHAR(100),
    last_name VARCHAR(100),
    email VARCHAR(100)
);
 
CREATE TABLE orders(
    id INT AUTO_INCREMENT PRIMARY KEY,
    order_date DATE,
    amount DECIMAL(8,2),
    customer_id INT,
    FOREIGN KEY(customer_id) 
        REFERENCES customers(id)
        ON DELETE CASCADE // 이 조건을 추가하면 customers 테이블의 유저가 삭제되었을 때
			  // orders에 있는 유저도 같이 삭제된다.
);
```

- `INNER JOIN`을 여러번 할 수도 있다. 
    - 교집합의 교집합

```
SELECT 
    title,
    rating,
    CONCAT(first_name,' ', last_name) AS reviewer
FROM reviewers
INNER JOIN reviews 
    ON reviewers.id = reviews.reviewer_id
INNER JOIN series
    ON series.id = reviews.series_id
ORDER BY title;
```

---

### References

- [Udemy: The Ultimate MySQL Bootcamp: Go from SQL Beginner to Expert](https://www.udemy.com/the-ultimate-mysql-bootcamp-go-from-sql-beginner-to-expert/)