2019ë…„ 4ì›” 28ì¼

# Javascript í´ë¡œì €2

> ì•„ë˜ ë‚´ìš©ì€ ëŒ€ë¶€ë¶„ [Udemy: Advanced JavaScript Concepts by Andrei Neagoie](<https://www.udemy.com/advanced-javascript-concepts/>)ì„ ì°¸ê³ í•´ì„œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤. 

 ## Closures

- í´ë¡œì €(closures)ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ì¼ê¸‰ í•¨ìˆ˜ì™€ lexical scopeë¼ëŠ” ë‘ ê°€ì§€ íŠ¹ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤.
![Screen Shot 2019-04-27 at 7.51.57 PM](./img/Closures-FirstClassFunction-LexicalScope.png)

- Closures allow a function to access variables from an enclosing scope or environment even after it leaves the scope which it was declared

```javascript
function a() {
    const grandFather = 'grandFather';
    return function b() {
        const father = 'father';
        return function c() {
            const son = 'son';
            return `${grandFather} > ${father} > ${son}`
        }
    }
}
console.log(a()()()); // grandFather > father > son
```

- ìœ„ ì˜ˆì œì—ì„œ í•¨ìˆ˜ a,bëŠ” í•¨ìˆ˜ë¥¼ ë¦¬í„´í•˜ê³  ìˆìœ¼ë¯€ë¡œ HOF(Higher Order Function)ì´ê³  cëŠ” ì¼ë°˜ í•¨ìˆ˜ì´ë‹¤.

- í•¨ìˆ˜ aì— ì˜í•´ í•¨ìˆ˜ cê°€ ì‹¤í–‰ë˜ì—ˆì„ ë•Œ ê²°ê³¼ê°’ì„ ë³´ì

- í•¨ìˆ˜ cì˜ ì§€ì—­ ë³€ìˆ˜ì¸ `son` ë¿ë§Œ ì•„ë‹ˆë¼ í•¨ìˆ˜ a,bì˜ ì§€ì—­ ë³€ìˆ˜ì¸ `grandFather` ì™€ `father` ë„ ì¶œë ¥ë˜ê³  ìˆë‹¤.

- ì¼ë°˜ì ìœ¼ë¡œ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ call stackì— í•´ë‹¹ í•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸(Execution context)ê°€ ìŒ“ì´ê³  í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ë©´ í•´ë‹¹ í•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸(Execution context)ëŠ” ì‚¬ë¼ì§„ë‹¤.  ì´ ë•Œ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸(Execution context) ì•ˆì— ìˆëŠ” ë³€ìˆ˜ ìœ íš¨ë²”ìœ„(variable environment)ë„ ê°™ì´ ì‚¬ë¼ì§„ë‹¤. ë”°ë¼ì„œ í•´ë‹¹ í•¨ìˆ˜ì˜ ì§€ì—­ ë³€ìˆ˜ì—ëŠ” ì ‘ê·¼ í•  ìˆ˜ ì—†ê²Œëœë‹¤.

- í•˜ì§€ë§Œ ìœ„ì˜ ê²½ìš°ëŠ” ê·¸ë ‡ì§€ ì•Šë‹¤.

- ê·¸ ì´ìœ ëŠ” ë°”ë¡œ í´ë¡œì €(closures) ë•Œë¬¸ì´ë‹¤.

- ì•„ë˜ ê·¸ë¦¼ì„ ë³´ì

![Screen Shot 2019-04-27 at 8.15.20 PM](./img/Closures1.png)

- a í•¨ìˆ˜ê°€ ì‹¤í–‰ ë˜ë©´ call stackì— ìœ„ì™€ ê°™ì´ a í•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ìŒ“ì¸ë‹¤. aí•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ì•ˆì—ëŠ” variable environmentê°€ ìˆê³  ê·¸ ì•ˆì— grandpaë¼ëŠ” ë³€ìˆ˜ê°€ ìˆë‹¤.

![Screen Shot 2019-04-27 at 8.15.48 PM](./img/Closures2.png)

- í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ a í•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ëŠ” call stackì—ì„œ ì‚¬ë¼ì§€ê³  grandpaëŠ” í´ë¡œì €(closures)ë¼ëŠ” ë°•ìŠ¤ ì•ˆìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤. í´ë¡œì €ëŠ” ë©”ëª¨ë¦¬ í™(memory heap)ì— ìˆëŠ” íŠ¹ë³„í•œ ê³µê°„ì´ë‹¤.
- ê°€ë¹„ì§€ ì»¬ë ‰í„°(garbage collector)ëŠ” í´ë¡œì €(closures)ë¥¼ íŠ¹ë³„í•œ ê³µê°„ìœ¼ë¡œ ì—¬ê¸°ê³  ì œê±°í•˜ì§€ ì•ŠëŠ”ë‹¤.

![Screen Shot 2019-04-27 at 8.17.30 PM](./img/Closures3.png)

- b í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ call stackì— ìŒ“ì´ê³ 
- variable environment ì•ˆì— fatherë¼ëŠ” ë³€ìˆ˜ê°€ ìƒì„±ëœë‹¤.

![Screen Shot 2019-04-27 at 8.17.38 PM](./img/Closures4.png)

- b í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ë©´ ë³€ìˆ˜ fatherëŠ” í´ë¡œì €(closures)ì— ì €ì¥ëœë‹¤.

![Screen Shot 2019-04-27 at 8.18.13 PM](./img/Closures5.png)

- c í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ call stackì— ìŒ“ì¸ë‹¤.

- c í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ìœ¼ë¡œ ë³€ìˆ˜ `son`, `grnadpa`,`father` ê°€ í•„ìš”í•˜ë‹¤.

- `son` ì€ c í•¨ìˆ˜ì˜ variable environment ì•ˆì— ìˆìœ¼ë¯€ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤.

- í•˜ì§€ë§Œ `grnadpa`,`father` ëŠ” c í•¨ìˆ˜ì˜ variable environmentì— ì—†ê¸° ë•Œë¬¸ì— scope chainì„ í†µí•´ ì ‘ê·¼ì„ ì‹œë„í•œë‹¤.

- ì´ ë•Œ ì „ì—­ ë³€ìˆ˜ í™˜ê²½(global environment)ê°€ ì•„ë‹Œ í´ë¡œì €(closures)ì— `grnadpa`,`father` ê°€ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.

- í´ë¡œì €ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´ì˜ íŠ¹ì§•ì´ë‹¤.

- í´ë¡œì €ë¥¼ ì´ìš©í•˜ë©´ ì™¸ë¶€ í•¨ìˆ˜ê°€ ì¢…ë£Œëœ ì´í›„ì—ë„ ë‚´ë¶€ í•¨ìˆ˜ì—ì„œ ì™¸ë¶€ í•¨ìˆ˜ ë³€ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

- ê°€ë¹„ì§€ ì»¬ë ‰í„°(garbage collector)ëŠ” í´ë¡œì €(closures)ë¥¼ íŠ¹ë³„í•œ ê³µê°„ìœ¼ë¡œ ì—¬ê¸°ê³  ì œê±°í•˜ì§€ ì•ŠëŠ”ë‹¤. ê°€ë¹„ì§€ ì»¬ë ‰í„°ëŠ” í´ë¡œì €ì— ë‹´ê¸´ ë³€ìˆ˜ëŠ” ë‚´ë¶€í•¨ìˆ˜ì—ì„œ ì°¸ì¡°í•˜ê³  ìˆëŠ” ë³€ìˆ˜ë¼ê³  ì—¬ê¸°ê¸° ë•Œë¬¸ì´ë‹¤. ë§Œì•½ ì™¸ë¶€í•¨ìˆ˜ì˜ ë³€ìˆ˜ì¼ì§€ë¼ë„ ë‚´ë¶€ í•¨ìˆ˜ì—ì„œ ì°¸ì¡°í•˜ëŠ” ë³€ìˆ˜ê°€ ì•„ë‹ˆë©´ í´ë¡œì €ì— ë‹´ê¸°ì§€ ì•Šìœ¼ë©° ê°€ë¹„ì§€ ì»¬ë ‰í„°ì— ì˜í•´ ì œê±°ëœë‹¤.

```javascript
function a() {
    const grandFather = 'grandFather';
    return function b() {
        const father = 'father';
        const random = 123183521;
        return function c() {
            const son = 'son';
            return `${grandFather} > ${father} > ${son}`
        }
    }
}
console.log(a()()()); // grandFather > father > son
```

- ìœ„ ì˜ˆì œì—ì„œ b í•¨ìˆ˜ ë‚´ì— `random`  ë³€ìˆ˜ê°€ ìˆë‹¤.
- `random` ë³€ìˆ˜ëŠ” ë‚´ë¶€ í•¨ìˆ˜(c)ì—ì„œ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ë³€ìˆ˜ì´ë‹¤.
- ë”°ë¼ì„œ `random` ë³€ìˆ˜ëŠ” b í•¨ìˆ˜ ì¢…ë£Œ ì‹œ í´ë¡œì €ì— ì €ì¥ë˜ì§€ ì•Šê³  ê°€ë¹„ì§€ ì»¬ë ‰í„°ì— ì˜í•´ ì œê±°ëœë‹¤.



-  í´ë¡œì €(closure)ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë‹¤ìŒ ë‘ ê°€ì§€ íŠ¹ì„±ì— ì˜í•´ ë™ì‘í•œë‹¤.

![Screen Shot 2019-04-27 at 7.51.57 PM](./img/Closures-FirstClassFunction-LexicalScope.png)

- 1. ì¼ê¸‰ í•¨ìˆ˜(First citizen function)ì´ê¸° ë•Œë¬¸ì— í•¨ìˆ˜ë¥¼ ë¦¬í„´ê°’ìœ¼ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.
  2. lexical scopeë¥¼ ë”°ë¥´ê¸° ë•Œë¬¸ì— í•¨ìˆ˜ê°€ ì„ ì–¸ëœ ë¶€ë¶„ì— ì˜í•´ scope chainì´ ì •í•´ì§„ë‹¤.

- í´ë¡œì €ë¼ëŠ” íŠ¹ì„±ì„ ì´ìš©í•´ ë‚´ë¶€ í•¨ìˆ˜ì—ì„œ ì™¸ë¶€í•¨ìˆ˜ì˜ ì§€ì—­ ë³€ìˆ˜ë¥¼ ìì‹ ì˜ ì§€ì—­ ë³€ìˆ˜ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

- ë‚´ë¶€í•¨ìˆ˜ì˜ í´ë¡œì €ì— ë‚´ë¶€í•¨ìˆ˜ê°€ ì°¸ì¡°í•˜ëŠ” ì™¸ë¶€í•¨ìˆ˜ì˜ ì§€ì—­ë³€ìˆ˜ê°€ ë‹´ê²¨ìˆê¸° ë•Œë¬¸ì— ììœ ë¡­ê²Œ ì ‘ê·¼í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```javascript
  function boo(string) {
    return function(name){
      return function(name2){
        console.log(`${string} ${name} ${name2}`)
      }
    }
  }
```

- ìœ„ í•¨ìˆ˜ëŠ” arrow í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ì•„ë˜ì™€ ê°™ì´ ê°„ë‹¨í•˜ê²Œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

```javascript
const boo = (greeting) => (name) => (name2) =>
console.log(`${greeting} ${name} ${name2}`)
```

```javascript
boo('hi')('sony')('park') // hi sony park
```

- í´ë¡œì €ì˜ ë§‰ê°•í•œ í˜ì€ ì•„ë˜ì™€ ê°™ì€ ê²½ìš°ì— ë°œíœ˜ëœë‹¤.

```javascript
const booGreeting = boo('hi');
// 5 years later
const booGreetingName = booGreeting('sony');
// 10 years later
const booGreetingName2 = booGreetingName('park');
console.log(booGreetingName2); // hi sony park
```

- booë¥¼ í•œ ë²ˆ ì‹¤í–‰í•˜ë©´ `hi`ë¼ëŠ” ë³€ìˆ˜ê°€ boo ë‚´ë¶€ í•¨ìˆ˜ì˜ í´ë¡œì €ì— ì €ì¥ëœë‹¤.

- ì´ ë§ì€ ì•„ë¬´ë¦¬ ì‹œê°„ì´ ì§€ë‚˜ë„ ë‚´ë¶€í•¨ìˆ˜ì—ì„œ ì–¸ì œë“ ì§€ ìì‹ ì´ ì°¸ì¡°í•˜ê³  ìˆëŠ” ì™¸ë¶€í•¨ìˆ˜ ë³€ìˆ˜ì— ì ‘ê·¼ í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•œë‹¤.

- ìœ„ì™€ ê°™ì€ ì´ìœ  ë•Œë¬¸ì— í´ë¡œì €ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ í”„ë¡œê·¸ë˜ë°ì—ì„œ ë§ì´ í™œìš©ë˜ê³  ê·¸ ë§Œí¼ ì¤‘ìš”í•˜ë‹¤.

### Exercise Closures 1

```javascript
function callMeMaybe() {
  const callMe = 'Hi! I am Sony';
  setTimeout(function () {
      console.log(callMe);
  }, 4000);
}
callMeMaybe(); // Hi! I am Sony
```

- ìœ„ ì˜ˆì œì—ì„œ callMeMaybeí•¨ìˆ˜ ì•ˆì— setTimeoutí•¨ìˆ˜ê°€ ìˆìœ¼ë©°  setTimeoutí•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜ë¡œ ìµëª… í•¨ìˆ˜ê°€ ìˆë‹¤. 

- ìµëª… í•¨ìˆ˜ëŠ” callMeMaybeí•¨ìˆ˜ì˜ ë‚´ë¶€í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— í´ë¡œì €ë¥¼ í†µí•´ ì™¸ë¶€í•¨ìˆ˜ callMeMaybeì˜ ì§€ì—­ ë³€ìˆ˜ callMeì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

- ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ ë‚´ì—ì„œ ìœ„ í•¨ìˆ˜ì˜ ë™ì‘ ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. (ì´í•´í•˜ê¸° ì‰½ê²Œ ì„¤ëª…í•˜ê¸° ìœ„í•œ ìˆœì„œì´ë¯€ë¡œ ì‹¤ì œ ë™ì‘ìˆœì„œì™€ëŠ” ë‹¤ë¥´ë‹¤.)

- callMeMaybeí•¨ìˆ˜ê°€ ì‹¤í–‰ëœë‹¤.
- call stackì— callMeMaybeí•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ìŒ“ì¸ë‹¤.
- callMeMaybeí•¨ìˆ˜ì˜ ì½œë°±í•¨ìˆ˜ì¸ setTimeout í•¨ìˆ˜ê°€ ì‹¤í–‰ëœë‹¤.
- setTimeout í•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜(ìµëª…í•¨ìˆ˜)ê°€ Web APIë¡œ ë³´ë‚´ì§„ë‹¤.
- callMeMaybeí•¨ìˆ˜ê°€ ì¢…ë£Œë˜ë©° ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ call stackì—ì„œ ì‚¬ë¼ì§„ë‹¤.
- setTimeout í•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜(ìµëª…í•¨ìˆ˜)ê°€ Web APIì—ì„œ 4ì´ˆê°„ ë¨¸ë¬´ë¥¸ë‹¤.
- ì‹œê°„ì´ ì™„ë£Œë˜ë©´ callback Queueë¡œ ë„˜ì–´ê°„ë‹¤.
- call stackì´ ë¹„ì–´ ìˆìœ¼ë©´ setTimeout í•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜(ìµëª…í•¨ìˆ˜)ê°€ call stackìœ¼ë¡œ ì˜¬ë¼ê°„ë‹¤.
- setTimeout í•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜(ìµëª…í•¨ìˆ˜)ê°€ ì‹¤í–‰ëœë‹¤.
  - console.log(callMe); // Hi! I am Sony

```javascript
function callMeMaybe() {
    setTimeout(function () {
        console.log(callMe);
    }, 4000);
    const callMe = 'Hi! I am Sony';
}
callMeMaybe(); // Hi! I am Sony
```

- callMe ë³€ìˆ˜ì˜ ìœ„ì¹˜ë¥¼ setTimeoutí•¨ìˆ˜ ë°‘ìœ¼ë¡œ ë³€ê²½í•´ë„ ê²°ê³¼ëŠ” ë™ì¼í•˜ë‹¤.

- callMe ë³€ìˆ˜ëŠ” constë¡œ ì„ ì–¸í–ˆê¸° ë•Œë¬¸ì— í˜¸ì´ìŠ¤íŒ…ì´ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤.

- í•˜ì§€ë§Œ í˜¸ì´ìŠ¤íŒ…ê³¼ ê´€ê³„ ì—†ì´ setTimeoutí•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜ì—ì„œ callMe ë³€ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

- ê·¸ ì´ìœ ëŠ” ìœ„ì˜ ë™ì‘ ìˆœì„œë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë‹¤.

- setTimeoutí•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜ ë³´ë‹¤ callMeMaybeí•¨ìˆ˜ê°€ ë¨¼ì € ì‹¤í–‰ í›„ ì¢…ë£Œëœë‹¤.

- ë”°ë¼ì„œ callMeMaybeí•¨ìˆ˜ì˜ ì§€ì—­ ë³€ìˆ˜ì¸ callMeë³€ìˆ˜ëŠ” ì´ë¯¸ ì„ ì–¸ë˜ì–´ í´ë¡œì €ì— ì €ì¥ëœ ìƒíƒœì´ë‹¤.

- ê·¸ëŸ¬ë¯€ë¡œ setTimeoutí•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜ì—ì„œ callMe ë³€ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

## Closures and Memory

- í´ë¡œì €ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒ ë‘ ê°€ì§€ íš¨ê³¼ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆë‹¤.

1. **Memory Efficient**
2. **Encapsulation**

### Memory Efficient

- í´ë¡œì €ë¥¼ ì´ìš©í•˜ë©´ ë©”ëª¨ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ìˆë‹¤.

- ì•„ë˜ ì˜ˆì œë¥¼ ë³´ì

```javascript
function heavyDuty(index) {
    const bigArray = new Array(7000).fill('ğŸ™‚');
    console.log('bigArray created!');
    return bigArray[index]
}
heavyDuty(600); // bigArray created! ğŸ™‚
heavyDuty(700); // bigArray created! ğŸ™‚
heavyDuty(800); // bigArray created! ğŸ™‚
```

- ìœ„ í•¨ìˆ˜ëŠ” ëŒ€ìš©ëŸ‰ì˜ ë°ì´í„°ë¥¼ ë‹´ëŠ” Arrayë¥¼ ìƒì„±í•˜ê³  íŠ¹ì • ì¸ë±ìŠ¤ì˜ ê°’ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
- ì´ í•¨ìˆ˜ëŠ” í˜¸ì¶œë  ë•Œë§ˆë‹¤ bigArrayë¥¼ ìƒì„±í•œë‹¤.
- í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ë©´ ê°€ë¹„ì§€ ì»¬ë ‰í„°ì— ì˜í•´ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°ëœë‹¤.
- ë¶ˆí•„ìš”í•œ ë¡œì§ì„ ë°˜ë³µí•¨ìœ¼ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ì´ ë‚®ë‹¤.

```javascript
// Closures
function heavyDutyWithClosures() {
    const bigArray = new Array(7000).fill('ğŸ™‚');
    console.log('bigArray created and restored in Closures!');
    return function (index) {
        return bigArray[index]
    }
}
const getHeavyDuty = heavyDutyWithClosures(); // bigArray created and restored in Closures!
getHeavyDuty(600); // ğŸ™‚
getHeavyDuty(700); // ğŸ™‚
getHeavyDuty(800); // ğŸ™‚
```

- ìœ„ ì˜ˆì œëŠ” ê°™ì€ ë¡œì§ì„ í´ë¡œì €ë¥¼ ì´ìš©í•˜ì—¬ êµ¬í˜„í–ˆë‹¤.
- heavyDutyWithClosuresëŠ” í•œ ë²ˆë§Œ í˜¸ì¶œë˜ê³  ì¢…ë£Œëœë‹¤.
- bigArrayë„ í•œ ë²ˆë§Œ ìƒì„±ë˜ê³  getHeavyDuty í•¨ìˆ˜ì˜ í´ë¡œì €ì— ì €ì¥ëœë‹¤.
- getHeavyDutyí•¨ìˆ˜ëŠ” í´ë¡œì €ì— ì €ì¥ëœ bigArrayë¥¼ í†µí•´ ì›í•˜ëŠ” indexì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
- ì´ì „ ì˜ˆì œì™€ ë¹„êµí–ˆì„ ë•Œ bigArrayë¥¼ í•œ ë²ˆë§Œ ìƒì„±í•˜ê³  í´ë¡œì €ì— ì €ì¥í•˜ë¯€ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ì´ ë†’ì•„ì¡Œë‹¤.

## Closures and Encapsulation

- Encapsulation: ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§ˆ í•„ìš”ê°€ ì—†ê±°ë‚˜ ì‚¬ìš©ìê°€ ì ‘ê·¼í•´ì„œëŠ” ì•ˆë˜ëŠ” ì†ì„±(ë³€ìˆ˜ or í•¨ìˆ˜)ì„ ìº¡ìŠ ì•ˆì— ê°ì¶°ë‘ëŠ” ê²ƒì„ ë§í•œë‹¤.

```javascript
// Encapsulation
const makeNuclearButton = () =>{
    let timeWithoutDestruction = 0;
    const passTime = () => timeWithoutDestruction++;
    const totalPeaceTime = () => timeWithoutDestruction;
    const launch = () => {
        timeWithoutDestruction = -1;
        return 'ğŸ’¥';
    };
    setInterval(passTime, 1000);
    return{
        'totalPeaceTime': totalPeaceTime
    }
};

const ohno = makeNuclearButton();
ohno.totalPeaceTime(); // í­íƒ„ì´ í„°ì§€ì§€ ì•Šê³  ê²½ê³¼í•œ ì‹œê°„ ì¶œë ¥(1..2..3)
ohno.launch(); // ohno.launch is not a function
```

- ìœ„ ì˜ˆì œì—ì„œ  launch() ë¥¼ í˜¸ì¶œí•˜ë©´ í­íƒ„ì´ í„°ì§€ëŠ” makeNuclearButton í•¨ìˆ˜ê°€ ì„ ì–¸ë˜ì–´ìˆë‹¤.
- launch í•¨ìˆ˜ëŠ” í­íƒ„ì´ í„°ì§€ëŠ” ìœ„í—˜í•œ ë²„íŠ¼ì´ê¸° ë•Œë¬¸ì— ì‚¬ìš©ìê°€ ì ‘ê·¼í•˜ì§€ ëª»í•˜ê²Œ í•˜ê³  ì‹¶ë‹¤.
- ì´ ë•Œ í´ë¡œì €ë¥¼ í†µí•´ ìº¡ìŠí™”(Encapsulation)í•˜ì—¬ ì‚¬ìš©ìê°€ launch í•¨ìˆ˜ì— ì ‘ê·¼í•˜ì§€ ëª» í•˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤.

## Exercise Closures 2

- í´ë¡œì €ë¥¼ ì´ìš©í•´ ì´ˆê¸°í™” í•¨ìˆ˜ë¥¼ í•œ ë²ˆë§Œ í˜¸ì¶œë˜ë„ë¡ í•´ë³´ì.

```javascript
let background;
function intialize(){
  background = 'â›°';
  console.log('background has been set!')
}
intialize(); // background has been set!
intialize(); // background has been set!
intialize(); // background has been set!
```

- ìœ„ ì˜ˆì œëŠ” ë°°ê²½í™”ë©´ì„ ì´ˆê¸°í™” í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
- ì´ˆê¸°í™”ëŠ” ì²˜ìŒ í•œ ë²ˆë§Œ ì§„í–‰ë˜ë©´ ëœë‹¤.
- ê·¸ëŸ°ë° ìœ„ ì˜ˆì œì—ì„œëŠ” intialize() ê°€ í˜¸ì¶œ ë  ë•Œë§ˆë‹¤ ì´ˆê¸°í™”ê°€ ì§„í–‰ëœë‹¤.
- í´ë¡œì €ë¥¼ ì´ìš©í•´ ë‹¤ìŒê³¼ ê°™ì´ ë°”ê¿”ë³´ì.

```javascript
let background;
function intialize() {
  let called = 0;
  return function () {
      if(called >0){
          return;
      }
      else{
          background = 'â›°';
          called++;
          console.log('background has been set!')
      }
  }
}
const startOnce = intialize();
startOnce(); // View has been set!
startOnce();
startOnce();
```

- í´ë¡œì €(closures)ë¥¼ ì´ìš©í•˜ë©´ intializeê°€ ë‹¨ í•œ ë²ˆë§Œ í˜¸ì¶œë˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

## Exercise Closures 2

- ë‹¤ìŒì€ ì˜ˆì œëŠ” ë©´ì ‘ì—ì„œ ë§¤ìš° ìì£¼ ë¬¼ì–´ë³´ëŠ” ì§ˆë¬¸ì´ë‹¤.

- `for loop` ì•ˆì˜ `setTimeout`ê³¼ ë³€ìˆ˜ `i`

```javascript
const arr = [1,2,3,4];
for(var i=0; i< arr.length; i++){
  setTimeout(function () {
      console.log(i)
  }, 1000)
}
// output
// 4
// 4
// 4
// 4
```

- ìœ„ ì˜ˆì œë¥¼ ì‹¤í–‰í•˜ë©´ ê²°ê³¼ê°’ì€ 4ê°€ 4ë²ˆ ì¶œë ¥ëœë‹¤.

- ê·¸ ì´ìœ ëŠ” setTimeoutì˜ ì½œë°± í•¨ìˆ˜ê°€ `ì „ì—­ ë³€ìˆ˜ i`ë¥¼ ì°¸ì¡°í•˜ê³  ìˆê¸° ë•Œë¬¸ì´ë‹¤.

- setTimeoutì˜ ì½œë°± í•¨ìˆ˜ê°€ Web APIì™€ callback Queueë¥¼ ê±°ì³ call stackì—ì„œ ì‹¤í–‰ë  ë•ŒëŠ” for ë¬¸ì´ ëë‚˜ê³  `i`ê°€ 4ê°€ ëœ ì‹œì ì´ë‹¤.

- ë”°ë¼ì„œ 4ê°€ 4ë²ˆ ì¶œë ¥ëœë‹¤.

- í•˜ì§€ë§Œ ì›í•˜ëŠ” ê²°ê³¼ê°’ì€ 0,1,2,3 ì´ ì¶œë ¥ë˜ëŠ” ê²ƒì´ë¼ê³  í•´ë³´ì.

- ì›í•˜ëŠ” ê²°ê³¼ê°’ì„ ì–»ê¸° ìœ„í•´ ë‹¤ìŒ ë‘ ê°€ì§€ ë°©ë²•ì„ ì´ìš©í•  ìˆ˜ ìˆë‹¤. (ì´ ë‘ ê°€ì§€ ë°©ë²•ë§Œ ìˆëŠ” ê±´ ì•„ë‹ˆë‹¤.)

- 1. **let ì‚¬ìš©**

```javascript
// let ì‚¬ìš© -> make 'i' as a block scope variable
const arr = [1,2,3,4];
for(let i=0; i< arr.length; i++){
    setTimeout(function () {
        console.log(i)
    }, 1000)
}
// output
// 0
// 1
// 2
// 3
```

- ë³€ìˆ˜ iì˜ keywordë¥¼ `var`ëŒ€ì‹  `let` ë¡œ ë°”ê¿”ì£¼ëŠ” ê²ƒë§Œìœ¼ë¡œ ê°„ë‹¨íˆ í•´ê²°ëœë‹¤.
- ê·¸ ì´ìœ ëŠ” `let` keywordëŠ”  ë¸”ë¡ ìŠ¤ì½”í”„ë¥¼ ë”°ë¥´ê¸° ë•Œë¬¸ì— ë³€ìˆ˜ ië¥¼ forë¬¸ ë¸”ë¡ ì•ˆì˜ ì§€ì—­ë³€ìˆ˜ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.
- ë”°ë¼ì„œ setTimeoutì˜ ì½œë°± í•¨ìˆ˜ê°€ ì°¸ì¡°í•˜ëŠ” ë³€ìˆ˜ iëŠ” for ë¬¸ ë¸”ë¡ ìŠ¤ì½”í”„ ì•ˆì— ìˆëŠ” ië¥¼ ì°¸ì¡°í•˜ê²Œ ëœë‹¤.
- ì¦‰, for ë¬¸ ì•ˆì—ì„œ setTimeoutì´ ì‹¤í–‰ ë  ë•Œë§ˆë‹¤ `setTimeoutì˜ ì½œë°± í•¨ìˆ˜ì—ì„œ ì°¸ì¡°í•˜ëŠ”  ë³€ìˆ˜ i`ëŠ”`ì‹¤í–‰ ì‹œì ì˜ for ë¬¸ ë¸”ë¡ ì•ˆì˜ i` ê°€ ëœë‹¤.

2. **ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ë¥¼ í†µí•œ í´ë¡œì € ìƒì„±**

```javascript
// ì¦‰ì‹œ ì‹¤í–‰í•¨ìˆ˜ë¥¼ í†µí•´ í´ë¡œì €(closures) ìƒì„±
const arr = [1,2,3,4];
for(var i=0; i< arr.length; i++) {
    (function (closureI) {
        setTimeout(function () {
            console.log(closureI)
        }, 1000)
    })(i)
}
// output
// 0
// 1
// 2
// 3
```

- setTimeoutì„ ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ë¡œ ê°ìŒŒë‹¤.
- ì´ë ‡ê²Œ ë˜ë©´ ì¦‰ì‹œ ì‹¤í–‰í•¨ìˆ˜ê°€ ì™¸ë¶€í•¨ìˆ˜ê°€ ë˜ê³  setTimeoutì€ ë‚´ë¶€í•¨ìˆ˜ê°€ ëœë‹¤.
- ì´ ë•Œ ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ì—ì„œ for ë¬¸ì˜ ë³€ìˆ˜ ië¥¼ ì¸ìë¡œ ë°›ìœ¼ë©´ `ë³€ìˆ˜ i(closureI)`ëŠ” ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ì˜ ì§€ì—­ ë³€ìˆ˜ê°€ ëœë‹¤.
- setTimeout(ë‚´ë¶€í•¨ìˆ˜)ëŠ” ìŠ¤ì½”í”„ ì²´ì¸ì— ì˜í•´  ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜(ì™¸ë¶€í•¨ìˆ˜)ì˜ ì§€ì—­ ë³€ìˆ˜ì¸ `closureI` ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.
- ê·¸ëŸ¬ë¯€ë¡œ ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ë•Œ setTimeout í•¨ìˆ˜ì˜ ì½œë°±í•¨ìˆ˜ëŠ” í´ë¡œì €ë¥¼ ìƒì„±í•˜ì—¬ í•´ë‹¹ ì‹œì ì˜ `ë³€ìˆ˜i(closureI`)ë¥¼ ì €ì¥í•œë‹¤.
- ì´ë¥¼ í†µí•´ ì›í•˜ëŠ” ê²°ê³¼ê°’ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.

## ì •ë¦¬

![Screen Shot 2019-04-27 at 7.51.57 PM](./img/Closures-FirstClassFunction-LexicalScope.png)

- Closures allow a function to access variables from an enclosing scope or environment even after it leaves the scope which it was declared because all that matters in Javascript is where the function was written



### Reference

- [Udemy: Advanced JavaScript Concepts by Andrei Neagoie](<https://www.udemy.com/advanced-javascript-concepts/>)
- [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures)
- [javascripttutorial](http://www.javascripttutorial.net/javascript-prototype/)
- [ì¸ì‚¬ì´ë“œ ìë°”ìŠ¤í¬ë¦½íŠ¸](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9788968480652)